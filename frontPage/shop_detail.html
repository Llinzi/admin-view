<!DOCTYPE html>
<html lang="en">
  <head>
    <title>Index</title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=0">
    <meta name="keywords" content="blog, business, clean, clear, cooporate, creative, design web, flat, marketing, minimal, portfolio, shop, shopping, unique">
    <meta name="author" content="MARTECH | Deer Creative Theme">
    <link rel="stylesheet" href="assets/css/style.css">
    <link rel="stylesheet" href="assets/css/custom_bootstrap.css">
    <link rel="stylesheet" href="assets/css/normalize.css">
    <link rel="stylesheet" href="assets/css/fontawesome.css">
    <link rel="stylesheet" href="assets/css/elegant.css">
    <link rel="stylesheet" href="assets/css/animate.css">
    <link rel="stylesheet" href="assets/css/slick.css">
    <link rel="stylesheet" href="assets/css/scroll.css">
    <link rel="stylesheet" href="assets/css/icomoon.css">
    <link rel="stylesheet" href="assets/css/jquery.fancybox.min.css">
    <link rel="shortcut icon" href="assets/images/shortcut_logo.png">
  </head>
  <body>
    <div id="main">
      <!-- End header-->
      <div class="ogami-breadcrumb">
        <div class="ogami-container-fluid">
          <ul>
            <li> <a class="breadcrumb-link" href="index.html"> <i class="fas fa-home"></i>主页</a></li>
            <li> <a class="breadcrumb-link" href="shop_grid+list_3col.html">咖啡</a></li>
            <li> <a class="breadcrumb-link active" href="">咖啡详情</a></li>
          </ul>
        </div>
      </div>
      <!-- End breadcrumb-->
      <div class="shop-layout">
        <div class="ogami-container-fluid">
          <div class="row">
            <div class="col-12">
              <div class="shop-detail shop-detail-fullwidth">
                <div class="row">
                  <div class="col-12 col-xl-5">
                    <div class="shop-detail_img">
                      <div class="row">
                        <div class="col-10">
                          <div class="big-img">
                            <div class="big-img_block">
                              <img  v-if="coffeeDetail.coffeePhoto == null || coffeeDetail.coffeePhoto == ''" src="../assets/images/products/1.jpg" width="500px" height="400px">
                              <img  v-else :src="coffeeDetail.coffeePhoto">
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                  <div class="col-12 col-xl-7">
                    <div class="row">
                      <div class="col-md-7 col-lg-7 col-xxl-8">
                        <div class="shop-detail_info">
                          <h5 class="product-type color-type">{{coffeeDetail.coffeeName}}</h5>
                          <h3 class="product-name">咖啡详情</h3>
                          <div class="product-describe_block">
                            <p class="product-describe">{{coffeeDetail.coffeeDetails}}</p>
                          </div>
                        </div>
                        <div class="shop-detail_info">
                          <h3 class="product-name">咖啡简介</h3>
                          <div class="product-describe_block">
                            <p class="product-describe">{{coffeeDetail.coffeeBrief}}</p>
                          </div>
                        </div>
                      </div>
                      <div class="col-md-5 col-lg-5 col-xxl-4">
                        <div class="shop-detail_info shop-detail_info-full">
                          <p class="delivery-status">其它信息</p>
                          <div class="price-rate">
                            <h3 class="product-price"> 
                              <del>{{coffeeDetail.coffeePrices}}</del>{{coffeeDetail.coffeeDiscount}}
                            </h3>
                            <h5 class="product-rated" v-if="coffeeDetail.coffeeLevel == 5"><i class="icon_star"></i><i class="icon_star"></i><i class="icon_star"></i><i class="icon_star"></i></i><i class="icon_star"></i></h5>
                            <h5 class="product-rated" v-if="coffeeDetail.coffeeLevel == 4"><i class="icon_star"></i><i class="icon_star"></i><i class="icon_star"></i></i><i class="icon_star"></i></h5>
                            <h5 class="product-rated" v-if="coffeeDetail.coffeeLevel == 3"><i class="icon_star"></i><i class="icon_star"></i></i><i class="icon_star"></i></h5>
                            <h5 class="product-rated" v-if="coffeeDetail.coffeeLevel == 2"><i class="icon_star"></i><i class="icon_star"></i></h5>
                            <h5 class="product-rated" v-if="coffeeDetail.coffeeLevel == 1"><i class="icon_star"></i></h5>
                          </div>
                          <div class="quantity-select">
                            <label for="quantity">购买数量</label>
                            <input class="no-round-input" id="quantity" type="number" min="0" value="1">
                          </div>
                          <div class="product-select">
                            <button class="add-to-cart normal-btn outline">加入购物车</button>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                  <div class="col-12">
                    <div class="shop-detail_more-info">
                      <div id="tab-so3">
                        <ul class="mb-0">
                          <li> <a href="#tab-3">用户评论({{commentParams.total}})</a></li>
                        </ul>
                        <div id="tab-3">
                          <div class="customer-reviews_block">
                            <div class="customer-review" v-for="(data,index) in commentList">
                              <div class="row">
                                <div class="col-12 col-sm-3 col-lg-2 col-xxl-1">
                                  <div class="customer-review_left">
                                    <div class="customer-review_img text-center"><img class="img-fluid" :src="data.userHphoto" alt="customer image"></div>
                                  </div>
                                </div>
                                <div class="col-12 col-sm-9 col-lg-10 col-xxl-11">
                                  <div class="customer-comment">
                                    <h5 class="comment-date">{{((data.commentsDate).replace(/T/,"—")).substring(0,19)}}</h5>
                                    <h3 class="customer-name">{{data.userName }}</h3>
                                    <p class="customer-commented">{{data.commentsFilterContent}}
                                    <span style="color: white">11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111231111111111111111111111111111111111111111</span>
                                    </p>
                                  </div>
                                </div>
                              </div>
                            </div>
                            <div style="text-align: right;color: green">
                              <a href="javascript:void(0)" @click="moreComment()">查看更多评论</a>
                            </div>
                            <div class="add-review">
                              <div class="add-review_top">
                                <h2>添加评论</h2>
                              </div>
                              <div class="add-review_bottom">
                                <form action="#">
                                  <div class="row">
                                    <div class="col-12">
                                      <textarea v-model="commentContent" class="textarea-form" id="review" name="" cols="30" rows="5" placeholder="Message"></textarea>
                                    </div>
                                    <div class="col-12">
                                      <button type="button" class="normal-btn" @click="addComment()">发表评论</button>
                                    </div>
                                  </div>
                                </form>
                              </div>
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
      <!-- End shop layout-->
      <div class="partner partner_block-bgless">
        <div class="ogami-container-fluid">
          <div class="partner_block d-flex justify-content-between" data-slick="{&quot;slidesToShow&quot;: 8}">
            <div class="partner--logo" href=""> <a href="#"><img src="assets/images/partner/partner_01.png" alt="partner logo"></a></div>
            <div class="partner--logo" href=""> <a href="#"><img src="assets/images/partner/partner_02.png" alt="partner logo"></a></div>
            <div class="partner--logo" href=""> <a href="#"><img src="assets/images/partner/partner_01.png" alt="partner logo"></a></div>
            <div class="partner--logo" href=""> <a href="#"><img src="assets/images/partner/partner_02.png" alt="partner logo"></a></div>
            <div class="partner--logo" href=""> <a href="#"><img src="assets/images/partner/partner_01.png" alt="partner logo"></a></div>
            <div class="partner--logo" href=""> <a href="#"><img src="assets/images/partner/partner_02.png" alt="partner logo"></a></div>
            <div class="partner--logo" href=""> <a href=""><img src="assets/images/partner/partner_01.png" alt="partner logo"></a></div>
            <div class="partner--logo" href=""> <a href="#"><img src="assets/images/partner/partner_02.png" alt="partner logo"></a></div>
            <div class="partner--logo" href=""> <a href="#"><img src="assets/images/partner/partner_01.png" alt="partner logo"></a></div>
            <div class="partner--logo" href=""> <a href="#"><img src="assets/images/partner/partner_02.png" alt="partner logo"></a></div>
            <div class="partner--logo" href=""> <a href="#"><img src="assets/images/partner/partner_01.png" alt="partner logo"></a></div>
          </div>
        </div>
      </div>
      <!-- End partner-->
      <footer class="coffee">
        <div class="container">
          <div class="row">
            <div class="col-12 col-sm-12 col-md-4 text-sm-center text-md-left">
              <div class="footer-logo"><img src="assets/images/logo.png" alt=""></div>
              <div class="footer-contact">
                <p>地址: 贵州山咔咔里</p>
                <p>电话: 18396910028</p>
                <p>Email: 266255255@gmail.com</p>
              </div>
              <div class="footer-social"><a class="round-icon-btn coffee" href=""><i class="fab fa-facebook-f"> </i></a><a class="round-icon-btn coffee" href=""><i class="fab fa-twitter"></i></a><a class="round-icon-btn coffee" href=""><i class="fab fa-invision"> </i></a><a class="round-icon-btn coffee" href=""><i class="fab fa-pinterest-p"></i></a></div>
            </div>
            <div class="col-md-8">
              <div class="row">
                <div class="col-12 col-sm-4 text-sm-center text-md-left">
                  <div class="footer-quicklink">
                    <h5>信息化</h5><a href="about_us.html">关于我们</a><a href="checkout.html">退房</a><a href="contact.html">联系</a><a href="about_us.html">服务</a>
                  </div>
                </div>
                <div class="col-12 col-sm-4 text-sm-center text-md-left">
                  <div class="footer-quicklink">
                    <h5>My 我的账户</h5><a href="login.html">我的账户</a><a href="contact.html">联系</a><a href="shop_cart.html">购物车</a><a href="shop_grid+list_3col.html">店铺</a>
                  </div>
                </div>
                <div class="col-12 col-sm-4 text-sm-center text-md-left">
                  <div class="footer-quicklink">
                    <h5>快速店铺</h5><a href="about_us.html">关于我们</a><a href="checkout.html">退房</a><a href="contact.html">联系</a><a href="about_us.html">服务</a>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
        <div class="newletter">
          <div class="container">
            <div class="row justify-content-between align-items-center">
              <div class="col-12 col-md-7">
                <div class="newletter_text text-center text-md-left">
                  <h5>立即加入哦们的新闻通讯</h5>
                  <p>获取我们最新商品和特惠信息的电子邮件.</p>
                </div>
              </div>
              <div class="col-12 col-md-5">
                <div class="newletter_input">
                  <input class="round-input" type="text" placeholder="Enter your email">
                  <button>Subcribe</button>
                </div>
              </div>
            </div>
          </div>
        </div>
        <div class="footer-credit">
          <div class="container">
            <div class="footer-creadit_block d-flex flex-column flex-md-row justify-content-start justify-content-md-between align-items-baseline align-items-md-center">
              <p class="author">贵州民族大学2016级软件工程3班 <a href="http://www.17sucai.com/" title="17sucai">王显成，曹江柳，张正华</a>.</p><img class="payment-method" src="assets/images/payment.png" alt="">
            </div>
          </div>
        </div>
      </footer>
      <!-- End footer-->
    </div>
    <script src="assets/js/jquery.min.js"></script>
    <script src="assets/js/jquery-ui.min.js"></script>
    <script src="assets/js/jquery.countdown.min.js"></script>
    <script src="../assets/js/vue.min.js"></script>
    <script src="assets/js/slick.min.js"></script>
    <script src="assets/js/jquery.easing.js"></script>
    <script src="assets/js/jquery.scrollUp.min.js"></script>
    <script src="assets/js/jquery.zoom.min.js"></script>
    <script src="assets/js/parallax.js"></script>
    <script src="assets/js/jquery.fancybox.js"></script>
    <script src="assets/js/numscroller-1.0.js"></script>
    <script src="assets/js/vanilla-tilt.min.js"></script>
    <script src="assets/js/main.js"></script>
    <script src="../assets/js/axios.min.js"></script>
    <script>
      var vm = new Vue({
        el:"#main",
        data:{
          coffeeDetail:{},//咖啡详情
          commentParams:{
            coffeeId:0,
            pageSize:5,
            currentPage:1,
            total:0,
          },//查询评论参数
          commentList:[],//评论信息
          commentContent:"",//添加评论内容
        },
        mounted:function () {
          //获取咖啡详情
          this.coffeeDetail = JSON.parse(window.sessionStorage.getItem("coffeeDetail"));
          this.selectComment();
        },
        methods:{
          //查询该咖啡的评论
          selectComment:function () {
            this.commentParams.coffeeId = this.coffeeDetail.coffeeId;
            axios({
              method:'GET',
              url:'http://localhost:9000/comments/selectComments',
              params: this.commentParams,
            }).then(res =>{
              if (res.data.code === 0){
                console.log(res);
                this.commentList = res.data.dataList;
                vm.commentParams.currentPage = res.data.pageNum; //第几页
                vm.commentParams.total = res.data.total;//总条数
              }
            }).catch(res =>{
              console.log(res);
            })
          },

          //添加评论
          addComment:function () {
            if (this.commentContent == '' || this.commentContent == null){
              alert("请输入评论内容")
            }else {
              var userInfo = JSON.parse(window.sessionStorage.getItem("userInfo"));
              var userId = userInfo.userId;
              axios({
                method:'POST',
                url:'http://localhost:9000/comments/addComments',
                data:{
                  "coffeeId":this.coffeeDetail.coffeeId,
                  "userId":userId,
                  "commentsContent": this.commentContent
                },
                headers: {
                  "Content-Type":"application/json"
                }
              }).then(res => {
                if (res.data.code === 0){
                  this.selectComment();
                  alert(res.data.msg);
                }else {
                  alert(res.data.msg);
                }
              }).catch(res => {
                console.log(res);
              })
            }
          },
          moreComment:function () {
            this.commentParams.pageSize = this.commentParams.pageSize + 5;
            this.selectComment();
          }
        }
      });
    </script>
  </body>
</html>